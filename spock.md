# 単体テストの自動化

## 単体テストとは何か

タイトルにJavaと書いておきながら、ここまであんまりJavaのコードを書くことがありませんでしたが、[テキストファイルの読み書き](textfile.html)あたりからやっとJavaプログラミングらしくなってきました。

あまりプログラミングをしたことがない方は、プログラマは一気に何十行ものコードをばりばりと打ち込んでいるようなイメージを持っているかもしれません。[実際にそういう方もいらっしゃる](https://softether.hatenadiary.org/entry/20070324/p1)のですが、こういう方は特殊であり、普通はちょっと書いてはあっているかどうか動かして確認をし、思った通りに動作していることが確認できてはじめて、続きを書いていきます。1行書いて実行・・・どころか、1行書く間に何度も実行することもあるでしょう。
そのような動作の確認をしているときに、いちいちアプリケーション全体を起動していては大変です。なにしろ今私たちが作ろうとしているのはWebアプリケーションですから、起動するとWebサーバが立ち上がります。動作を確認するにはブラウザが必要です。けっこう面倒くさいですよね。ブラウザを立ち上げると、ついうっかり関係ないサイトを見てしまったりしますし。それは私だけか。ともあれ、今作っている部分だけを動かして、そこだけの動きを確認したいと考えるのは自然だと思います。

さて、プログラムの一部だけ動かしたいと考えたとして、それはどこからどこまででしょう。その範囲が決められないと困ります。素直な発想として、その単位は特定のメソッドだと考えていいでしょう。しかし、Javaのメソッドは必ずどれかのクラスに属しています。そして、クラスメソッドではない普通のメソッド(インスタンスメソッド)は、クラスをインスタンス化、つまりnewしてやらないと実行出来ません。

そこで、単体テストとはこのようなものだということが出来ます。アプリケーションの中の特定のクラスを通常のアプリケーションの流れとは別に、それだけをいきなりインスタンス化して、そのインスタンスのメソッドを動作させ、動きを確認する。アプリケーション全体を動かす必要がないのでラクチンです。

## テストしやすい構造

ということは、テストをするためには

* 単独でインスタンス化でき
* 単独で意味のあるメソッド

であることが必要です。そんなの当たり前じゃないかと思われるかもしれませんが、インスタンス化したら初期化プロセスでネットワーク先のサービスにアクセスに行ったり、メソッドを実行したら別の様々なクラスを呼び出したりするのはいただけません。テストの準備が大変になったり、あちこちに処理が飛んで結局何をテストしたかったのかわからなくなったりします。

これは実際にテストを作っていけばわかりますが、できるだけ他のものに依存せずにある入力をパラメータで渡したら、決まった出力が出てくるようなメソッドはテストがしやすいです。そのようにテストしやすいものを組み合わせていくと、アプリケーション全体の構造もわかりやすくなる傾向にあります。とりあえず、試してみたい部分を上手く1つのクラスの1つのメソッドに入れられたとしましょう。

## テストフレームワーク

さて、テストしたい対象がうまく分離できたとして、これをどうやって動作させればよいのでしょうか。それにはテストプログラムという別のアプリケーションを作ることになります。そのテストプログラムの中から、テストしたい部分を呼び出すわけです。つまり、「単体テストをする」ということは「テストしてくれる別のアプリケーションを作る」ということを意味します。ビックリしますね。

しかし、別のアプリケーションと言っても、単にテストしたいアプリの一部を取り出して実行するだけなので構える必要はありませんし、それを簡単につくるためのフレームワークも準備されています。一般にテストフレームワークと呼ばれます。イマドキのプログラミング言語だと言語の組み込みの機能としてテストフレームワークを持っていたりしますが、Javaはそうではありません。むしろ、テストフレームワークという技術自体が生まれたときに、真っ先に作られたのがJava用のテストフレームワークであるJUnitでした。由緒正しいのです。

JUnitは非常に有名なフレームワークなので、ぜひ、一度触ってみて欲しいのですが、今回はあえて別のフレームワークを採用します。Spockです

## Spock

(Spockの説明を書く)

### Spockのドキュメント

(たぶん本家のドキュメントを読むのがいいはず。)

(Groovyも本家でいいはず。)

### Spockのセットアップ

(build.gradleをセットアップするだけなので、それを書く）

## サンプル

(サンプルを載せる。普通のとSpring bootのやつと。)

## テスト駆動開発

(Kent Beckを読め！というようなことを書く)